# ZK-SNARK Ceremony Coordination

## Overview

This is a multi-party trusted setup ceremony for the Demos Network ZK identity system. The ceremony uses a fork-and-pull-request workflow with sequential contribution enforcement.

## Security Model

**Toxic Waste = Intermediate Key + Secret Entropy**

- Intermediate keys in this repo are safe to be public
- Secret entropy is generated locally and never shared
- As long as ONE contributor is honest, the system is secure
- Each contributor must delete their local copy after contributing

## Participant Requirements

1. GitHub account
2. Node software repository cloned locally
3. `publickey_<address>` file in repository root (auto-generated by node)
4. Bun and dependencies installed

## Contribution Workflow

### Step 1: Register Interest

Comment on the coordination issue with:

- Your GitHub username
- Your public key address (from filename)
- Confirmation you understand the process

### Step 2: Wait for Your Turn

The maintainer will:

- Review the queue
- Notify you when it's your turn
- Provide any additional instructions

### Step 3: Setup Node Repository

```bash
# Make sure you're on the zk_ids branch of the node repository
cd /path/to/demos/node
git checkout zk_ids
git pull origin zk_ids
```

### Step 4: Clone Ceremony Repository

```bash
# While in the node repository root, clone the ceremony repo
# This creates zk_ceremony/ folder inside your node repo
git clone https://github.com/kynesyslabs/zk_ceremony.git zk_ceremony

# The node repo's .gitignore already excludes zk_ceremony/
# so there's no nested repo conflict
```

### Step 5: Sync and Create Branch

```bash
# Before contributing, sync to get the latest state
cd zk_ceremony
git checkout main
git pull origin main

# Create your contribution branch
# Replace YOUR_ADDRESS with your actual address
git checkout -b contrib-YOUR_ADDRESS

# Remove the current origin pointing to kynesyslabs
git remote remove origin

# Add your fork as origin - replace USERNAME with your github username
git remote add origin https://github.com/USERNAME/zk_ceremony.git

# Verify
git remote -v
cd ..
```

### Step 6: Contribute

```bash
# From node repository root
bun run zk:ceremony contribute
```

The script will:

- Detect your identity from publickey_ed25519_* file
- Load the latest ceremony key
- Generate secure random entropy locally
- Add your contribution
- Create attestation file

### Step 7: Commit and Push

```bash
# Go into ceremony repo
cd zk_ceremony

# Verify changes
git status
ls -lh keys/  # Should see new ceremony_000N.zkey

# Commit
git add .
git commit -m "contrib: contribution from <your_address>"

# Push your branch
git push origin contrib-YOUR_ADDRESS
```

### Step 8: Create Pull Request

1. Go to https://github.com/kynesyslabs/zk_ceremony
2. You should see a prompt to create PR from your recent push
3. Click "Compare & pull request"
4. Base: main ‚Üê Compare: contrib-YOUR_ADDRESS
5. Title: "Contribution from <your_address>"
```bash
# Go back into your node directory and find the attestation hash
cd node
cat ~/node/zk_ceremony/attestations/000N_YOUR_ADDRESS.txt
```
7. Description: Include your attestation hash from attestations/ file 
8. Create pull request

### Step 9: Wait for Merge

The maintainer will:

- Verify your contribution
- Check attestation hash
- Merge your pull request
- Notify the next contributor

### Step 10: Delete Local Copy (CRITICAL)

```bash
# After your PR is merged, delete everything locally
cd /path/to/demos/node
rm -rf zk_ceremony/

# Keep only your attestation file as proof (optional)
# It was saved in: zk_ceremony/attestations/000N_<your_address>.txt

# Switch back to testnet branch
git checkout testnet
```

## Verification Commands

### Check Ceremony State

```bash
cat ceremony_state.json
# Shows: initiator, current key number, all contributors
```

### View Contribution History

```bash
git log --oneline --graph
# Shows timeline of contributions
```

### Verify Attestation

```bash
# Each contribution has attestation file
cat attestations/000N_<address>.txt
# Contains: participant, key number, attestation hash, timestamp
```

## Security Checklist

### For Contributors

- [ ] Generated entropy locally (automatic in ceremony script)
- [ ] Never shared entropy with anyone
- [ ] Pushed contribution to YOUR fork
- [ ] Created PR from your fork to main repo
- [ ] Deleted local zk_ceremony/ folder after merge
- [ ] Kept attestation file as proof (optional)

## Troubleshooting

**"No publickey_ed25519_* file found"**

- The file is auto-generated by the node on first start
- Run the node once: `bun run start` (then Ctrl+C)
- File will be created: `publickey_ed25519_0x<your_address>`

**"Ceremony not initialized"**

- You need to sync with upstream first
- Run: `git fetch upstream && git merge upstream/main`

**"You already contributed to this ceremony"**

- Each address can only contribute once (security requirement)
- This is intentional to maintain independence

**"Failed to push to your fork"**

- Make sure you're pushing to YOUR fork, not upstream
- Check remote: `git remote -v` should show YOUR username

**Merge conflicts**

- Sync with upstream: `git fetch upstream && git merge upstream/main`
- Resolve conflicts (keep both contributions)
- Push again

## After Ceremony Completion

The maintainer will:

1. Run `bun run zk:ceremony finalize`
2. Export verification key
3. Upload keys to CDN
4. Commit final verification key to main node repository
5. Generate ceremony report
6. Keep ceremony repository public as audit trail

This repository will remain public permanently as proof of the ceremony process.

## Questions?

- Ask in coordination issue comments

---

**Remember:** As long as ONE contributor is honest and deleted their local copy, the final keys are cryptographically secure. Your participation helps decentralize trust!
